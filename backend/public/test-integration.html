<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee JavaScript Integration Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            color: #333;
            margin-top: 0;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }
        .test-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .test-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-warning { background: #ffc107; }
        .status-info { background: #17a2b8; }
    </style>
</head>
<body>
    <h1>Employee JavaScript Integration Test</h1>
    <p>This page tests the integration of all Employee JavaScript modules with the backend API.</p>

    <!-- Test Results Container -->
    <div id="testResults" class="test-container">
        <h2>Test Results</h2>
        <div id="testSummary"></div>
    </div>

    <!-- EmployeeUtils Test -->
    <div class="test-container">
        <div class="test-section">
            <h3>EmployeeUtils Test</h3>
            <button class="test-button" onclick="testEmployeeUtils()">Test EmployeeUtils</button>
            <div id="employeeUtilsResult" class="test-result" style="display: none;"></div>
        </div>
    </div>

    <!-- PermissionsHandler Test -->
    <div class="test-container">
        <div class="test-section">
            <h3>PermissionsHandler Test</h3>
            <button class="test-button" onclick="testPermissionsHandler()">Test PermissionsHandler</button>
            <div id="permissionsResult" class="test-result" style="display: none;"></div>
        </div>
    </div>

    <!-- API Integration Test -->
    <div class="test-container">
        <div class="test-section">
            <h3>API Integration Test</h3>
            <button class="test-button" onclick="testAPIEndpoints()">Test API Endpoints</button>
            <div id="apiResult" class="test-result" style="display: none;"></div>
        </div>
    </div>

    <!-- Module Loading Test -->
    <div class="test-container">
        <div class="test-section">
            <h3>Module Loading Test</h3>
            <button class="test-button" onclick="testModuleLoading()">Test Module Loading</button>
            <div id="moduleResult" class="test-result" style="display: none;"></div>
        </div>
    </div>

    <!-- Notification System Test -->
    <div class="test-container">
        <div class="test-section">
            <h3>Notification System Test</h3>
            <button class="test-button" onclick="testNotifications()">Test Notifications</button>
            <div id="notificationResult" class="test-result" style="display: none;"></div>
        </div>
    </div>

    <!-- Form Validation Test -->
    <div class="test-container">
        <div class="test-section">
            <h3>Form Validation Test</h3>
            <form id="testForm">
                <input type="text" name="name" placeholder="Name" required>
                <input type="email" name="email" placeholder="Email" required>
                <input type="password" name="password" placeholder="Password" required>
                <button type="submit" class="test-button">Test Form Validation</button>
            </form>
            <div id="formResult" class="test-result" style="display: none;"></div>
        </div>
    </div>

    <!-- Load all JavaScript modules -->
    <script src="/js/Employee/shared/EmployeeUtils.js"></script>
    <script src="/js/Employee/shared/PermissionsHandler.js"></script>
    <script src="/js/Employee/Admin/AdminLogs.js"></script>
    <script src="/js/Employee/Admin/AdminAlerts.js"></script>
    <script src="/js/Employee/Admin/AdminCMS.js"></script>
    <script src="/js/Employee/Admin/AdminManageUsers.js"></script>
    <script src="/js/Employee/Inventory/InventoryManager.js"></script>
    <script src="/js/Employee/Inventory/InvManagerAlerts.js"></script>
    <script src="/js/Employee/Inventory/InventoryProducts.js"></script>
    <script src="/js/Employee/Support/OrderSupport.js"></script>
    <script src="/js/Employee/Support/SupportManager.js"></script>
    <script src="/js/Employee/Transaction/TransactionManager.js"></script>
    <script src="/js/Employee/UserManager/UserManager.js"></script>

    <script>
        // Test results tracking
        let testResults = {
            total: 0,
            passed: 0,
            failed: 0,
            warnings: 0
        };

        // Test EmployeeUtils
        function testEmployeeUtils() {
            const result = document.getElementById('employeeUtilsResult');
            result.style.display = 'block';
            
            try {
                testResults.total++;
                
                // Test if EmployeeUtils is loaded
                if (typeof window.EmployeeUtils === 'undefined') {
                    result.innerHTML = '<span class="status-indicator status-error"></span>EmployeeUtils not loaded';
                    result.className = 'test-result test-error';
                    testResults.failed++;
                    return;
                }

                // Test utility functions
                const utils = window.EmployeeUtils;
                let tests = [];

                // Test notification system
                try {
                    utils.showNotification('Test notification', 'success', 1000);
                    tests.push('✓ Notification system working');
                } catch (e) {
                    tests.push('✗ Notification system failed: ' + e.message);
                }

                // Test date formatting
                try {
                    const formattedDate = utils.formatDate(new Date());
                    tests.push('✓ Date formatting working: ' + formattedDate);
                } catch (e) {
                    tests.push('✗ Date formatting failed: ' + e.message);
                }

                // Test currency formatting
                try {
                    const formattedCurrency = utils.formatCurrency(123.45);
                    tests.push('✓ Currency formatting working: ' + formattedCurrency);
                } catch (e) {
                    tests.push('✗ Currency formatting failed: ' + e.message);
                }

                // Test API request
                try {
                    // This will fail but we can test the error handling
                    utils.apiRequest('/api/test-endpoint')
                        .catch(() => {
                            tests.push('✓ API request error handling working');
                        });
                } catch (e) {
                    tests.push('✗ API request failed: ' + e.message);
                }

                const successCount = tests.filter(t => t.startsWith('✓')).length;
                const totalTests = tests.length;

                result.innerHTML = `
                    <span class="status-indicator status-success"></span>
                    EmployeeUtils loaded successfully<br>
                    ${tests.join('<br>')}<br>
                    <strong>Result: ${successCount}/${totalTests} tests passed</strong>
                `;
                result.className = 'test-result test-success';
                testResults.passed++;

            } catch (error) {
                result.innerHTML = '<span class="status-indicator status-error"></span>EmployeeUtils test failed: ' + error.message;
                result.className = 'test-result test-error';
                testResults.failed++;
            }
        }

        // Test PermissionsHandler
        function testPermissionsHandler() {
            const result = document.getElementById('permissionsResult');
            result.style.display = 'block';
            
            try {
                testResults.total++;
                
                // Test if PermissionsHandler is loaded
                if (typeof window.userPermissions === 'undefined') {
                    result.innerHTML = '<span class="status-indicator status-error"></span>PermissionsHandler not loaded';
                    result.className = 'test-result test-error';
                    testResults.failed++;
                    return;
                }

                const permissions = window.userPermissions;
                let tests = [];

                // Test permission checking
                try {
                    const hasPermission = permissions.hasPermission('test');
                    tests.push('✓ Permission checking working');
                } catch (e) {
                    tests.push('✗ Permission checking failed: ' + e.message);
                }

                // Test role checking
                try {
                    const isAdmin = permissions.isAdmin();
                    tests.push('✓ Role checking working');
                } catch (e) {
                    tests.push('✗ Role checking failed: ' + e.message);
                }

                // Test UI updates
                try {
                    permissions.updateUI();
                    tests.push('✓ UI update working');
                } catch (e) {
                    tests.push('✗ UI update failed: ' + e.message);
                }

                const successCount = tests.filter(t => t.startsWith('✓')).length;
                const totalTests = tests.length;

                result.innerHTML = `
                    <span class="status-indicator status-success"></span>
                    PermissionsHandler loaded successfully<br>
                    ${tests.join('<br>')}<br>
                    <strong>Result: ${successCount}/${totalTests} tests passed</strong>
                `;
                result.className = 'test-result test-success';
                testResults.passed++;

            } catch (error) {
                result.innerHTML = '<span class="status-indicator status-error"></span>PermissionsHandler test failed: ' + error.message;
                result.className = 'test-result test-error';
                testResults.failed++;
            }
        }

        // Test API Endpoints
        function testAPIEndpoints() {
            const result = document.getElementById('apiResult');
            result.style.display = 'block';
            
            testResults.total++;
            
            const endpoints = [
                '/api/rawmaterials',
                '/api/dashboard/products-count',
                '/api/dashboard/materials-count',
                '/api/admin/products',
                '/api/categories'
            ];

            let tests = [];
            let completedTests = 0;

            endpoints.forEach(endpoint => {
                fetch(endpoint)
                    .then(response => {
                        if (response.ok) {
                            tests.push(`✓ ${endpoint} - OK (${response.status})`);
                        } else {
                            tests.push(`⚠ ${endpoint} - ${response.status} ${response.statusText}`);
                        }
                    })
                    .catch(error => {
                        tests.push(`✗ ${endpoint} - ${error.message}`);
                    })
                    .finally(() => {
                        completedTests++;
                        if (completedTests === endpoints.length) {
                            updateAPIResult(result, tests);
                        }
                    });
            });
        }

        function updateAPIResult(result, tests) {
            const successCount = tests.filter(t => t.startsWith('✓')).length;
            const warningCount = tests.filter(t => t.startsWith('⚠')).length;
            const errorCount = tests.filter(t => t.startsWith('✗')).length;

            let statusClass = 'test-success';
            let statusIcon = 'status-success';
            let statusText = 'All API endpoints working';

            if (errorCount > 0) {
                statusClass = 'test-error';
                statusIcon = 'status-error';
                statusText = 'Some API endpoints failed';
            } else if (warningCount > 0) {
                statusClass = 'test-info';
                statusIcon = 'status-warning';
                statusText = 'Some API endpoints have warnings';
            }

            result.innerHTML = `
                <span class="status-indicator ${statusIcon}"></span>
                ${statusText}<br>
                ${tests.join('<br>')}<br>
                <strong>Result: ${successCount} success, ${warningCount} warnings, ${errorCount} errors</strong>
            `;
            result.className = `test-result ${statusClass}`;

            if (errorCount === 0) {
                testResults.passed++;
            } else {
                testResults.failed++;
            }
        }

        // Test Module Loading
        function testModuleLoading() {
            const result = document.getElementById('moduleResult');
            result.style.display = 'block';
            
            testResults.total++;
            
            const modules = [
                'AdminLogs',
                'AdminAlerts', 
                'AdminCMS',
                'AdminManageUsers',
                'InventoryManager',
                'InvManagerAlerts',
                'InventoryProducts',
                'OrderSupport',
                'SupportManager',
                'TransactionManager',
                'UserManager'
            ];

            let tests = [];
            let loadedCount = 0;

            modules.forEach(module => {
                if (typeof window[module] !== 'undefined') {
                    tests.push(`✓ ${module} loaded successfully`);
                    loadedCount++;
                } else {
                    tests.push(`✗ ${module} not loaded`);
                }
            });

            const statusClass = loadedCount === modules.length ? 'test-success' : 'test-error';
            const statusIcon = loadedCount === modules.length ? 'status-success' : 'status-error';

            result.innerHTML = `
                <span class="status-indicator ${statusIcon}"></span>
                Module loading test completed<br>
                ${tests.join('<br>')}<br>
                <strong>Result: ${loadedCount}/${modules.length} modules loaded</strong>
            `;
            result.className = `test-result ${statusClass}`;

            if (loadedCount === modules.length) {
                testResults.passed++;
            } else {
                testResults.failed++;
            }
        }

        // Test Notifications
        function testNotifications() {
            const result = document.getElementById('notificationResult');
            result.style.display = 'block';
            
            testResults.total++;
            
            try {
                if (typeof window.EmployeeUtils === 'undefined') {
                    result.innerHTML = '<span class="status-indicator status-error"></span>EmployeeUtils not available for notification test';
                    result.className = 'test-result test-error';
                    testResults.failed++;
                    return;
                }

                // Test different notification types
                window.EmployeeUtils.showNotification('Success notification', 'success', 2000);
                setTimeout(() => {
                    window.EmployeeUtils.showNotification('Error notification', 'error', 2000);
                }, 500);
                setTimeout(() => {
                    window.EmployeeUtils.showNotification('Warning notification', 'warning', 2000);
                }, 1000);
                setTimeout(() => {
                    window.EmployeeUtils.showNotification('Info notification', 'info', 2000);
                }, 1500);

                result.innerHTML = `
                    <span class="status-indicator status-success"></span>
                    Notification system test completed<br>
                    ✓ Success notification displayed<br>
                    ✓ Error notification displayed<br>
                    ✓ Warning notification displayed<br>
                    ✓ Info notification displayed<br>
                    <strong>Result: All notification types working</strong>
                `;
                result.className = 'test-result test-success';
                testResults.passed++;

            } catch (error) {
                result.innerHTML = '<span class="status-indicator status-error"></span>Notification test failed: ' + error.message;
                result.className = 'test-result test-error';
                testResults.failed++;
            }
        }

        // Test Form Validation
        document.getElementById('testForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const result = document.getElementById('formResult');
            result.style.display = 'block';
            
            testResults.total++;
            
            try {
                if (typeof window.EmployeeUtils === 'undefined') {
                    result.innerHTML = '<span class="status-indicator status-error"></span>EmployeeUtils not available for form validation test';
                    result.className = 'test-result test-error';
                    testResults.failed++;
                    return;
                }

                const formData = window.EmployeeUtils.serializeForm(this);
                const validation = window.EmployeeUtils.validateForm(this, {
                    name: { required: true, label: 'Name', minLength: 2 },
                    email: { required: true, label: 'Email', pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/ },
                    password: { required: true, label: 'Password', minLength: 6 }
                });

                if (validation.isValid) {
                    result.innerHTML = `
                        <span class="status-indicator status-success"></span>
                        Form validation test passed<br>
                        ✓ Form data serialized successfully<br>
                        ✓ All validation rules passed<br>
                        <strong>Result: Form validation working correctly</strong>
                    `;
                    result.className = 'test-result test-success';
                    testResults.passed++;
                } else {
                    result.innerHTML = `
                        <span class="status-indicator status-warning"></span>
                        Form validation test completed with errors<br>
                        ✗ Validation errors: ${validation.errors.join(', ')}<br>
                        <strong>Result: Form validation working but found errors</strong>
                    `;
                    result.className = 'test-result test-info';
                    testResults.warnings++;
                }

            } catch (error) {
                result.innerHTML = '<span class="status-indicator status-error"></span>Form validation test failed: ' + error.message;
                result.className = 'test-result test-error';
                testResults.failed++;
            }
        });

        // Update test summary
        function updateTestSummary() {
            const summary = document.getElementById('testSummary');
            const total = testResults.total;
            const passed = testResults.passed;
            const failed = testResults.failed;
            const warnings = testResults.warnings;

            let statusClass = 'test-success';
            let statusIcon = 'status-success';
            let statusText = 'All tests passed';

            if (failed > 0) {
                statusClass = 'test-error';
                statusIcon = 'status-error';
                statusText = 'Some tests failed';
            } else if (warnings > 0) {
                statusClass = 'test-info';
                statusIcon = 'status-warning';
                statusText = 'All tests passed with warnings';
            }

            summary.innerHTML = `
                <div class="test-result ${statusClass}">
                    <span class="status-indicator ${statusIcon}"></span>
                    <strong>${statusText}</strong><br>
                    Total Tests: ${total} | Passed: ${passed} | Failed: ${failed} | Warnings: ${warnings}
                </div>
            `;
        }

        // Update summary every 2 seconds
        setInterval(updateTestSummary, 2000);

        // Initial summary update
        updateTestSummary();
    </script>
</body>
</html>
